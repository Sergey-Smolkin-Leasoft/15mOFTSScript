# ContextBot for cTrader

Этот cBot определяет рыночный контекст (тренд) на основе процентного изменения цены за заданное количество дней.

## Настройка

1.  **Откройте cTrader Desktop.**
2.  Перейдите в раздел **Automate** (Автоматизация) в левой панели.
3.  Нажмите кнопку **New** (Новый) для создания нового cBot.
4.  Дайте ему имя, например, `ContextBot`.
5.  cTrader сгенерирует файл `.cs` для вашего нового бота (например, `ContextBot.cs`). Откройте его в редакторе cTrader (обычно двойным кликом по имени бота в списке).
6.  **Полностью замените** содержимое этого сгенерированного файла кодом из файла `ContextBot.cs`, который был предоставлен.
7.  Нажмите кнопку **Build** (Собрать) (иконка с молотком или в меню Build) для компиляции бота. Убедитесь, что в логе сборки нет ошибок.

## Использование

1.  После успешной сборки бота, найдите его в списке доступных cBots в разделе Automate.
2.  **ВАЖНО**: Для корректной работы параметра `Days for Context` (Количество дней для контекста), рекомендуется добавлять этот бот на **дневной (D1)** график нужного вам инструмента (например, XAUUSD, EURUSD).
    *   Если вы используете другой таймфрейм, расчеты будут основаны на барах этого таймфрейма (например, `Days for Context = 3` на H1 графике будет означать 3 часа, а не 3 дня).
3.  Кликните на "+" рядом с именем бота, чтобы добавить экземпляр на активный график, или перетащите его на график.
4.  В окне параметров экземпляра бота вы можете настроить:
    *   **Days for Context**: Количество дней для анализа (по умолчанию: 3).
    *   **Min. % Change for Context**: Минимальное процентное изменение цены, необходимое для определения тренда (по умолчанию: 3.75%).
5.  Нажмите **OK**. Бот запустится.

## Проверка работы

*   **Лог cBot**: В разделе Automate, на вкладке "Log" (Лог) для вашего экземпляра бота, вы будете видеть сообщения о его работе, включая:
    *   Старт бота и используемые параметры.
    *   Предупреждение, если бот запущен не на D1 графике.
    *   Сообщения о недостаточности данных (если на графике мало истории).
    *   Обновления рыночного контекста с указанием процентного изменения.
*   **На графике**: В правом верхнем углу графика будет отображаться текущий определенный контекст и процентное изменение.

## Как это работает

Бот выполняет следующие действия при старте и на каждом новом баре (на D1 графике это происходит раз в день):

1.  Проверяет, достаточно ли исторических данных.
2.  Берет цену закрытия последнего завершенного бара (например, вчерашнего дня).
3.  Берет цену закрытия бара, который был `Days for Context` периодов назад от этого последнего завершенного бара.
4.  Рассчитывает процентное изменение между этими двумя ценами.
5.  Если изменение больше или равно `Min. % Change for Context`, устанавливается контекст "Uptrend".
6.  Если изменение меньше или равно `-Min. % Change for Context`, устанавливается контекст "Downtrend".
7.  В противном случае, контекст "Ranging/Undefined".

--- 

Пожалуйста, **проверь работу бота вручную**, выполнив шаги из README. 
Для его работы тебе понадобится запущенный cTrader Desktop. Добавь бота на дневной график (D1) выбранного инструмента и понаблюдай за логами и информацией на графике. 