# config.py - MODIFIED


from datetime import timedelta # ИСПРАВЛЕНО: Импортируем timedelta

TWELVEDATA_API_KEY = "9c614fea46d04e3d8c4f3f76b0541ab6" # Твой API ключ (замени на свой)

# Активы в формате Twelve Data
ASSETS = [
    "GBP/USD",
    #"EUR/USD", # Закомментировано
    #"XAU/USD"  # Закомментировано
]

# Таймфреймы: теперь и H1, и M15
TIMEFRAMES = {
    "H1": "1h",
    "M15": "15min",
}

TIMEFRAME_DURATIONS_MINUTES = {
    "H1": 60,
    "M15": 15
    # Добавьте сюда другие таймфреймы, если они будут использоваться в TIMEFRAMES
}

DAILY_CHECK_TIME_UTC = "08:00:00" # Время проверки стратегии каждый день в формате HH:MM:SS (UTC)
# Определите, насколько далеко в прошлое загружать данные для lookback при каждом ежедневном сканировании
# Это должно быть как минимум LIQUIDITY_LOOKBACK в терминах M15 свечей, переведенных в timedelta
# Например, если LIQUIDITY_LOOKBACK = 20 (40 свечей M15 для 2*lookback), это 40 * 15 минут = 600 минут = 10 часов.
# Нужно обеспечить наличие H1 и M15 данных за этот период перед DAILY_CHECK_TIME_UTC.
# Определим это как timedelta
LOOKBACK_WINDOW_FOR_SCAN = timedelta(hours=12) # Пример: Окно данных за последние 12 часов для каждого ежедневного скана

BACKTESTING_ASSET = "GBP/USD" # Актив для бэктестинга (оставьте, если нужен GBP/USD)
BACKTESTING_START_DATE = "2023-01-01 00:00:00" # Начальная дата бэктеста: 1 января 2023 года 00:00:00 UTC
BACKTESTING_END_DATE = "2023-01-31 23:59:59"   # Конечная дата бэктеста: 31 января 2023 года 23:59:59 UTC

INITIAL_CAPITAL = 10000.0 # Начальный капитал для бэктеста
RISK_PER_TRADE_FIXED = None # Или фиксированная сумма риска, например 100.0 (сделайте RISK_PER_TRADE_PERCENT = None)

RISK_PER_TRADE_PERCENT = 1.0 # Риск на сделку в процентах от текущего капитала (например, 1.0 для 1%)
TD_BACKTEST_OUTPUT_SIZE_H1 = 5000 # Максимум по вашему тарифу
TD_BACKTEST_OUTPUT_SIZE_M15 = 5000 # Максимум по вашему тарифу
ASSUMED_PIP_VALUE_PER_LOT = 10.0 # $10 за пипс на стандартный лот (100k единиц) для EUR/USD, GBP/USD

# Сколько последних свечей запрашивать для каждого таймфрейма
TD_OUTPUT_SIZES = {
    "H1": 200, # Достаточно данных для анализа контекста на H1 (~8 дней)
    "M15": 500, # ~5 дней данных для M15
}

# Параметры стратегии
LIQUIDITY_LOOKBACK = 10 # Используем тот же lookback для H1 и M15 ликвидности
MIN_RR = 1.5
IMBALANCE_THRESHOLD = 0.00001 # Рекомендуется маленькое значение для форекса
LONDON_OPEN_HOUR = 8     # Час открытия Лондона (UTC)
LONDON_CLOSE_HOUR = 17   # Час закрытия Лондона (UTC)

# Минимальное количество свечей после пробоя структуры для поиска отката/входа на M15
MIN_STRUCTURE_BREAK_CANDLES = 5

# --- НОВАЯ КОНСТАНТА для определения H1 контекста ---
# Минимальное количество свечей после H1 свипа для поиска подтверждения OF на H1
MIN_H1_OF_CANDLES = 10
# --------------------------------------------------


# Задержка между проверками (в секундах)
CHECK_INTERVAL_SECONDS = 15 * 60 # Проверка каждые 15 минут